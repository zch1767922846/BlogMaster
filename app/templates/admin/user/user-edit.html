{% extends 'admin/base.html' %}

{% block main %}
<div class="layui-fluid" style="margin:10px 0px">
    <div class="layui-row layui-col-space20">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body">
                    <form class="layui-form" action="/admin/user/{{ user_id }}" method="post">
                        {{ user_form.hidden_tag() }}

                        <div class="layui-form-item">
                            <label class="layui-form-label">用户名</label>
                            <div class="layui-input-block">
                                {{ user_form.username(class="layui-input", placeholder="请输入用户名") }}
                                {% if user_form.username.errors %}
                                <div class="layui-form-mid layui-text-danger">{{ user_form.username.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">昵称</label>
                            <div class="layui-input-block">
                                {{ user_form.nickname(class="layui-input", placeholder="请输入昵称") }}
                                {% if user_form.nickname.errors %}
                                <div class="layui-form-mid layui-text-danger">{{ user_form.nickname.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">密码</label>
                            <div class="layui-input-block">
                                {{ user_form.password(class="layui-input", placeholder="不修改请留空") }}
                                {% if user_form.password.errors %}
                                <div class="layui-form-mid layui-text-danger">{{ user_form.password.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">邮箱</label>
                            <div class="layui-input-block">
                                {{ user_form.email(class="layui-input", placeholder="请输入邮箱") }}
                                {% if user_form.email.errors %}
                                <div class="layui-form-mid layui-text-danger">{{ user_form.email.errors[0] }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-block">
                                <input type="radio" name="status" value="1" title="启用" {% if user_form.status.data == 1 %}checked{% endif %}>
                                <input type="radio" name="status" value="0" title="禁用" {% if user_form.status.data == 0 %}checked{% endif %}>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                {{ user_form.submit(class="layui-btn", value="提交") }}
                                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
{{ super() }}
<script>
layui.use('form', function(){
    var form = layui.form;
    var layer = layui.layer;

    // 表单渲染
    form.render();

    // 监听提交
    form.on('submit(submit)', function(data) {
        $.ajax({
            url: '/admin/user/{{ user_id }}',
            type: 'POST',
            data: data.field,
            success: function(res) {
                if (res.code === 20000000) {
                    layer.msg('更新成功', {icon: 6}, function() {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                        parent.location.reload();
                    });
                } else {
                    layer.msg(res.message, {icon: 5});
                }
            },
            error: function(xhr) {
                layer.msg('请求失败: ' + xhr.responseText, {icon: 5});
            }
        });
        return false;
    });
});
</script>
{% endblock %}